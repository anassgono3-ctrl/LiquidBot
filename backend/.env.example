# Example configuration emphasizing header-mode usage

PORT=3000
NODE_ENV=development

USE_MOCK_SUBGRAPH=false
# Header-mode endpoint (preferred: key not in URL)
SUBGRAPH_URL=https://gateway.thegraph.com/api/subgraphs/id/GQFbb95cE6d8mV989mL5figjaGaKCQB3xqYrr1bRyXqF
GRAPH_API_KEY=replace_with_gateway_key

# (If you omit SUBGRAPH_URL the service defaults to path-embedded:
# https://gateway.thegraph.com/api/<GRAPH_API_KEY>/subgraphs/id/<DEPLOYMENT_ID>
# )

SUBGRAPH_POLL_INTERVAL_MS=15000

# Liquidation Tracking
# Maximum liquidations to fetch per poll (default: 50)
LIQUIDATION_POLL_LIMIT=50
# Maximum unique liquidation IDs to track (default: 5000)
LIQUIDATION_TRACK_MAX=5000

# Resilience & Metrics
SUBGRAPH_FAILURE_THRESHOLD=5
SUBGRAPH_RETRY_ATTEMPTS=3
SUBGRAPH_RETRY_BASE_MS=150
SUBGRAPH_RATE_LIMIT_CAPACITY=30
SUBGRAPH_RATE_LIMIT_INTERVAL_MS=10000

# Database
DATABASE_URL=postgres://postgres:postgres@localhost:5432/liquidbot

# Redis (choose either URL or host/port)
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
# REDIS_URL=redis://127.0.0.1:6379

# Aave Pool (Base)
AAVE_POOL_ADDRESS=0xA238Dd80C259a72e81d7e4664a9801593F98d1c5

# Aave V3 Pool for health factor checks (optional - defaults to Base V3 Pool if not set)
# Used by ExecutionService to verify user is liquidatable before executing
# AAVE_POOL=0xA238Dd80C259a72e81d7e4664a9801593F98d1c5

# Auth
JWT_SECRET=replace_me
API_KEY=dev_key

# Debug deeper subgraph errors
# SUBGRAPH_DEBUG_ERRORS=true

# Telegram Notifications (optional - will be disabled if not set)
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here

# Health Monitoring (thresholds kept for reference, monitoring disabled)
HEALTH_ALERT_THRESHOLD=1.10
HEALTH_EMERGENCY_THRESHOLD=1.05

# Profit Estimation
PROFIT_FEE_BPS=30
PROFIT_MIN_USD=10

# Price Oracle (placeholder for future integration)
PRICE_ORACLE_MODE=coingecko

# Health Factor Resolution Mode
# Note: Bulk monitoring disabled. Health factors resolved on-demand per liquidation.
HEALTH_QUERY_MODE=on_demand

# Poll Configuration
# Maximum new liquidations to process per poll (default: 5)
POLL_LIMIT=5
# Ignore first (bootstrap) batch for notifications/opportunity pipeline (default: true)
IGNORE_BOOTSTRAP_BATCH=true

# Gas Cost Estimation
# Gas cost in USD for profit calculations (default: 0)
GAS_COST_USD=0

# Chainlink Price Feeds (optional - falls back to stub prices if not configured)
# RPC URL for Chainlink price feed queries
# CHAINLINK_RPC_URL=https://mainnet.base.org
# Comma-separated list of token:feedAddress pairs
# CHAINLINK_FEEDS=ETH:0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70,USDC:0x7e860098F58bBFC8648a4311b374B1D669a2bc6B

# At-Risk User Scanning (Optional)
# Number of users to scan per poll cycle (0 disables scanning)
AT_RISK_SCAN_LIMIT=50
# Health factor threshold for warning tier (HF below this triggers warning)
AT_RISK_WARN_THRESHOLD=1.05
# Health factor threshold for critical tier (HF below this is liquidatable)
AT_RISK_LIQ_THRESHOLD=1.0
# Debt threshold in ETH below which debt is considered dust (effectively zero)
AT_RISK_DUST_EPSILON=1e-9
# Whether to send notifications for critical tier users (default: true)
AT_RISK_NOTIFY_CRITICAL=true
# Whether to send notifications for warn tier users (default: false)
AT_RISK_NOTIFY_WARN=false

# Execution Scaffold (default: disabled for safety)
# Master switch to enable execution (default: false)
EXECUTION_ENABLED=false
# Dry run mode - simulate without broadcasting transactions (default: true)
DRY_RUN_EXECUTION=true
# Optional MEV relay URL (e.g., https://rpc.flashbots.net)
# PRIVATE_BUNDLE_RPC=
# Maximum allowed gas price in Gwei (default: 50)
MAX_GAS_PRICE_GWEI=50
# Minimum profit after gas costs in USD (default: 10)
MIN_PROFIT_AFTER_GAS_USD=10
# Maximum position size in USD (default: 5000)
MAX_POSITION_SIZE_USD=5000
# Daily loss limit in USD (default: 1000)
DAILY_LOSS_LIMIT_USD=1000
# Comma-separated list of blacklisted token symbols (e.g., WBTC,XYZ)
# BLACKLISTED_TOKENS=

# On-Chain Executor Configuration
# Deployed LiquidationExecutor contract address
# EXECUTOR_ADDRESS=0x...
# Private key for execution transactions (keep secure!)
# EXECUTION_PRIVATE_KEY=0x...
# RPC URL for Base network
# RPC_URL=https://mainnet.base.org
# Chain ID for Base
CHAIN_ID=8453
# 1inch API key for swap quotes (optional - falls back to v5 public API if not set)
# ONEINCH_API_KEY=your_api_key_here
# 1inch API base URL (auto-configured based on API key presence)
# v6 with API key: https://api.1inch.dev/swap/v6.0/8453
# v5 without API key: https://api.1inch.exchange/v5.0/8453
ONEINCH_BASE_URL=https://api.1inch.dev/swap/v6.0/8453
# Maximum slippage in basis points (100 = 1%)
MAX_SLIPPAGE_BPS=100
# Close factor mode: auto or fixed (default: auto)
CLOSE_FACTOR_MODE=auto

# Real-time HF Detection (runtime feature, opt-in)
# Master switch for real-time detection (default: false for safety)
USE_REALTIME_HF=false
# WebSocket RPC URL (required when USE_REALTIME_HF=true)
WS_RPC_URL=wss://mainnet.base.org
# Optional: attempt provider-specific flashblocks channel (default: false)
USE_FLASHBLOCKS=false
# Flashblocks WebSocket URL (provider-specific, if supported on Base)
# FLASHBLOCKS_WS_URL=wss://...
# Multicall3 address on Base (default: 0xca11bde05977b3631167028862be2a173976ca11)
MULTICALL3_ADDRESS=0xca11bde05977b3631167028862be2a173976ca11
# Aave Pool address for health factor checks (default: Base V3 Pool)
AAVE_POOL=0xA238Dd80C259a72e81d7e4664a9801593F98d1c5
# Health factor threshold in basis points (9800 = 0.98, below which user is liquidatable)
EXECUTION_HF_THRESHOLD_BPS=9800
# Subgraph candidate refresh cadence with jitter (seconds, default: 45)
REALTIME_SEED_INTERVAL_SEC=45
# Max candidates to maintain in memory (default: 300)
CANDIDATE_MAX=300

# Real-time HF Harness Configuration (test-only utility)
# Comma-separated candidate user addresses for monitoring (harness only)
# CANDIDATE_USERS=0x123...,0x456...
# Alternative: use subgraph to seed candidates (requires GRAPH_API_KEY + SUBGRAPH_DEPLOYMENT_ID)
# Number of users to seed from subgraph (default: 50)
SEED_LIMIT=50
# Duration to run harness in seconds (default: 60)
HARNESS_DURATION_SEC=60
# Optional Chainlink price feeds for additional price-trigger subscriptions
# Format: TOKEN:FEED_ADDRESS,TOKEN:FEED_ADDRESS (e.g., ETH:0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70,USDC:0x7e860098F58bBFC8648a4311b374B1D669a2bc6B)
# CHAINLINK_FEEDS=
